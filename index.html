<!DOCTYPE html>
<html lang="en-US" prefix="dcterms: http://purl.org/dc/terms/">
<head>
<meta name="generator" content="HTML Tidy for HTML5 for Mac OS X version 4.9.24">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="author" content="James Benner">
<meta property="dcterms:modified" content="2016-03-02T22:00:08Z">
<title>James Benner: DevOps CM Kata Presentation</title>
<link rel="stylesheet" href="bower_components/reveal.js/css/reveal.css">
<link rel="stylesheet" href="bower_components/reveal.js/css/theme/black.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/zenburn.min.css">
<link rel="stylesheet" href="main.css">
</head>
<body>
<div class="reveal">
<div class="slides">
<section>
<h1>DevOps CM Kata</h1>
<h3 class="mid-title">or</h3>
<h1>Automagically Provisioning a Server</h1>
</section>
<section>
<h2><em>“Who the Heck Is This Guy?”</em></h2>
<pre>
        <code class="hljs json">
    {
        "@context": "http://www.w3.org/2006/vcard/ns",
        "@type": "Individual",
        "fn": "James Benner",
        "hasURL": "http://www.jamesbenner.com",
        "hasURL": "https://github.com/jbenner-radham",
        "hasURL": "https://github.com/radioactivehamster"
    }
        </code>
    
</pre></section>
<section>
<h2><em>“Why a LAMP Stack?”</em></h2>
<p></p>
<ul>
<li>It's a well established and widely used stack.</li>
<li>It has widespread tooling support due to the above.</li>
</ul>
<p></p></section>
<section>
<h2><em>“What Are Some Alternatives?”</em></h2>
<p></p>
<ul>
<li>LEMP Stack</li>
<li>PHP-FPM + Apache MPM</li>
<li>HHVM + Nginx</li>
<li>Adding a Varnish Frontend to Any of the Above.</li>
</ul>
<p></p></section>
<section>
<h2>Kickstarting From Vagrant</h2>
<pre>
        <code class="hljs ruby">
    # Run Ansible from the Vagrant Host
    config.vm.provision "ansible" do |ansible|
      ansible.playbook = "ansible/playbook.yml"
    end
        </code>
    
</pre></section>
<section>
<h2>Starting Out With Our Playbook</h2>
<pre>
        <code class="hljs yaml">
    ---
    - hosts:  all
      become: true  # Perform the following tasks as "sudo".
      vars_files:
        - vars/apache.yml
        - vars/app.yml
      roles:
        - apt
        - git
        - apache
        - mariadb
        - php
        - app
        </code>
    
</pre></section>
<section>
<h2>Our APT Task</h2>
<pre>
        <code class="hljs yaml">
    ---
    - name: Update APT
      apt:  update_cache=yes
        </code>
    
</pre></section>
<section>
<h2>Installing Apache</h2>
<pre>
        <code class="hljs yaml">
    ---
    - name:           Install Apache
      apt:            name=apache2
    
    - name:           Install Apache Modules
      apache2_module: state=present name={{ item }}
      with_items:
        - rewrite
        - headers
        - expires
        </code>
    
</pre></section>
<section>
<h2>Configuring Apache</h2>
<pre>
        <code class="hljs yaml">
    - name:       Change Default Apache Site
      template:   src=vhost.conf.tpl
                  dest=/etc/apache2/sites-available/000-default.conf
    
    - name:       Change Apache Run User
      lineinfile: dest=/etc/apache2/envvars
                  regexp='export APACHE_RUN_USER=www-data'
                  line='export APACHE_RUN_USER=vagrant'
    
    - name:       Change Apache Run Group
      lineinfile: dest=/etc/apache2/envvars
                  regexp='export APACHE_RUN_GROUP=www-data'
                  line='export APACHE_RUN_GROUP=vagrant'
      notify:     Restart Apache
        </code>
    
</pre></section>
<section>
<h2>Installing Git</h2>
<ul>
<li>Needed for Composer Installs</li>
</ul>
<pre>
        <code class="hljs yaml">
    ---
    - name: Install Git
      apt:  name=git
        </code>
    
</pre></section>
<section>
<h2>Installing MariaDB</h2>
<pre>
        <code class="hljs yaml">
    ---
    - name:     Install MariaDB
      apt:      name=mariadb-server
    
    - name:     Install Python MySQLdb (for Ansible)
      apt:      name=python-mysqldb
    
    - name:     Create Database
      mysql_db: name={{ app.db.database }}
                state=present
                login_user={{ app.db.username }}
                login_password={{ app.db.password }}
        </code>
    
</pre></section>
<section>
<h2>Installing PHP</h2>
<pre>
        <code class="hljs yaml">
    ---
    - name:  Install PHP
      apt:   name=php5
    
    - name:  Install PHP Modules
      apt:   name={{ item }}
      with_items:
        - php5-curl
        - php5-intl
        - php5-mcrypt
        - php5-mysql
        </code>
    
</pre></section>
<section>
<h2>Configuring PHP</h2>
<pre>
        <code class="hljs yaml">
    - name:  Enable PHP Modules
      shell: php5enmod {{ item }}
      with_items:
        - curl
        - intl
        - json
        - opcache
        - mysql
        - mysqli
        - pdo
        - pdo_mysql
        </code>
    
</pre></section>
<section>
<h2>Installing PHP Apps</h2>
<ul>
<li>Composer - To Install PHP Packages</li>
<li>Prestissimo - To Speed Up Composer Installs</li>
</ul>
<pre>
        <code class="hljs yaml">
    - name:  Install Composer
      shell: &gt;
             curl -sS https://getcomposer.org/installer |
                 php -- --install-dir=/usr/local/bin
                        --filename=composer
             creates=/usr/local/bin/composer
             warn=no
    
    - name:  Install Prestissimo (to speed up Composer installs)
      shell: composer global require hirak/prestissimo
        </code>
    
</pre></section>
<section>
<h2>App Configuration</h2>
<pre>
        <code class="hljs yaml">
    - name:       Copy Environment File
      copy:       src=../src/.env.example
                  dest=/vagrant/src/.env
                  force=no
    
    - name:       Change DB Username
      lineinfile: dest=/vagrant/src/.env
                  regexp='DB_USERNAME=homestead'
                  line='DB_USERNAME='
    
    - name:       Change DB Password
      lineinfile: dest=/vagrant/src/.env
                  regexp='DB_PASSWORD=secret'
                  line='DB_PASSWORD='
        </code>
    
</pre></section>
<section>
<h2>App Configuration (continued)</h2>
<pre>
        <code class="hljs yaml">
    - name:       Run Composer Install
      shell:      (cd /vagrant/src &amp;&amp; composer install)
    
    - name:       Generate App Key
      shell:      (cd /vagrant/src &amp;&amp; php artisan key:generate)
    
    - name:       Run DB Migrations And Seeds
      shell:      &gt;
                  (cd /vagrant/src &amp;&amp;
                      php artisan migrate:refresh --seed)
        </code>
    
</pre></section>
</div>
<!-- .slides --></div>
<!-- .reveal -->
<script src="bower_components/reveal.js/js/reveal.js">
</script> 
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js">
</script> 
<script>
            Reveal.initialize();
            hljs.initHighlightingOnLoad();
</script>
</body>
</html>
